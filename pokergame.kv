#:import dp kivy.metrics.dp

<PokerGame>:
    orientation: 'horizontal'
    padding: 10
    spacing: 10

    BoxLayout:
        orientation: 'vertical'
        spacing: 10

        # Commitment hash and seed display
        BoxLayout:
            size_hint_y: None
            height: '40dp'
            spacing: 10
            Label:
                text: f"Hash: {root.commitment_text}"
                font_size: '14sp'
                text_size: self.width, None
                shorten: True
                halign: 'left'
            TextInput:
                text: root.seed_text
                font_size: '14sp'
                size_hint_x: 0.6
                readonly: True
                background_color: 0, 0, 0, 0
                foreground_color: 1, 1, 1, 1
                cursor_color: 1, 1, 1, 1
                halign: 'left'
                valign: 'middle'
                padding: [5, (self.height - self.line_height) / 2]

        ScrollView:
            size_hint_y: 0.4
            do_scroll_x: False
            do_scroll_y: True

            GridLayout:
                id: table_grid
                cols: 3
                size_hint_y: None
                height: self.minimum_height
                row_default_height: '30dp'
                spacing: 2
                padding: 2

        # Зона карт
        BoxLayout:
            size_hint_y: 0.4
            spacing: 10

            # Карты с HOLD
            BoxLayout:
                orientation: 'vertical'
                spacing: 5
                Image:
                    source: root.card_sources[0]
                ToggleButton:
                    text: 'HOLD'
                    font_size: '20sp'
                    size_hint_y: 0.2
                    state: 'down' if root.held_flags[0] else 'normal'
                    on_press: root.on_hold_toggle(0)

            BoxLayout:
                orientation: 'vertical'
                spacing: 5
                Image:
                    source: root.card_sources[1]
                ToggleButton:
                    text: 'HOLD'
                    font_size: '20sp'
                    size_hint_y: 0.2
                    state: 'down' if root.held_flags[1] else 'normal'
                    on_press: root.on_hold_toggle(1)

            BoxLayout:
                orientation: 'vertical'
                spacing: 5
                Image:
                    source: root.card_sources[2]
                ToggleButton:
                    text: 'HOLD'
                    font_size: '20sp'
                    size_hint_y: 0.2
                    state: 'down' if root.held_flags[2] else 'normal'
                    on_press: root.on_hold_toggle(2)

            BoxLayout:
                orientation: 'vertical'
                spacing: 5
                Image:
                    source: root.card_sources[3]
                ToggleButton:
                    text: 'HOLD'
                    font_size: '20sp'
                    size_hint_y: 0.2
                    state: 'down' if root.held_flags[3] else 'normal'
                    on_press: root.on_hold_toggle(3)

            BoxLayout:
                orientation: 'vertical'
                spacing: 5
                Image:
                    source: root.card_sources[4]
                ToggleButton:
                    text: 'HOLD'
                    font_size: '20sp'
                    size_hint_y: 0.2
                    state: 'down' if root.held_flags[4] else 'normal'
                    on_press: root.on_hold_toggle(4)

        # Кнопка управления игрой
        BoxLayout:
            size_hint_y: 0.15
            spacing: 10
            Button:
                id: action_btn
                text: root.action_text
                font_size: '24sp'
                size_hint_y: 0.8
                on_press: root.on_action()
                disabled: root.action_disabled

    # Правая панель — счёт, ставка, управление фишками, выигрыш
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: 0.3
        spacing: 10

        # === НОВОЕ: Кредитный блок (правый верх) ===
        BoxLayout:
            orientation: 'vertical'
            size_hint_y: None
            height: dp(120)
            padding: dp(6)
            spacing: dp(6)
            canvas.before:
                Color:
                    rgba: 0.12, 0.12, 0.12, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
            # строки с цифрами
            BoxLayout:
                size_hint_y: None
                height: dp(26)
                spacing: dp(8)
                Label:
                    text: "Кредит:"
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.size
                    font_size: '14sp'
                Label:
                    text: str(root.credit_outstanding)
                    halign: 'right'
                    valign: 'middle'
                    text_size: self.size
                    font_size: '14sp'
            BoxLayout:
                size_hint_y: None
                height: dp(26)
                spacing: dp(8)
                Label:
                    text: "Взято всего:"
                    halign: 'left'
                    valign: 'middle'
                    text_size: self.size
                    font_size: '14sp'
                Label:
                    text: str(root.credit_taken_total)
                    halign: 'right'
                    valign: 'middle'
                    text_size: self.size
                    font_size: '14sp'
            # кнопки
            BoxLayout:
                size_hint_y: None
                height: dp(44)
                spacing: dp(8)
                Button:
                    id: credit_btn
                    text: "Получить кредит +100"
                    font_size: '14sp'
                    on_press: root.get_credit(100)
                Button:
                    id: repay_btn
                    text: "Погасить"
                    font_size: '14sp'
                    disabled: True
                    on_press: root.repay_credit()

        Label:
            text: f"Текущий счёт: {root.current_balance}"
            font_size: '18sp'

        Label:
            text: f"Текущая ставка: {root.current_bet}"
            font_size: '18sp'

        # Стоимость фишки
        BoxLayout:
            size_hint_y: None
            height: '40dp'
            spacing: 5
            Button:
                text: '–'
                font_size: '18sp'
                on_press: root.decrease_chip_value()
                disabled: root.bet_controls_disabled
            Label:
                text: f"Цена фишки: {root.chip_value}"
                font_size: '18sp'
            Button:
                text: '+'
                font_size: '18sp'
                on_press: root.increase_chip_value()
                disabled: root.bet_controls_disabled

        # Количество фишек
        BoxLayout:
            size_hint_y: None
            height: '40dp'
            spacing: 5
            Button:
                text: '–'
                font_size: '18sp'
                on_press: root.decrease_chip_count()
                disabled: root.bet_controls_disabled
            Label:
                text: f"Кол-во фишек: {root.chip_count}"
                font_size: '18sp'
            Button:
                text: '+'
                font_size: '18sp'
                on_press: root.increase_chip_count()
                disabled: root.bet_controls_disabled

        # Выигрыш + комбинация
        Label:
            id: win_label
            markup: True
            text: f"[color=000000][b]Выигрыш: {root.win_amount}[/b][/color]\n[color=222222]{root.combo_text}[/color]"
            font_size: '32sp'
            halign: 'center'
            text_size: self.width, None
            canvas.before:
                Color:
                    rgba: 1, 1, 0, 1
                Rectangle:
                    pos: self.pos
                    size: self.size
